package com.tasklist.dao;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.Statement;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.stereotype.Component;

import com.tasklist.bean.Task;

@Component
public class TaskListDao {
	
	@Autowired
	@Qualifier("dataSource")
	private DataSource dataSource;
	
	private static String ADD_TASK = "insert into tasklist"
			+ "(taskid, taskdescription, taskcompletionstatus,userid)"
			+ "values(nextval('taskid'),?,?,"
			+ "(select userid from userlist where username=?))";
	
		
	public void addTask(Task task) throws Exception {
		Connection conn = dataSource.getConnection();
		PreparedStatement preparedStatement = conn.prepareStatement(ADD_TASK);
		preparedStatement.setString(1, task.getTaskDescription());
		preparedStatement.setString(2, task.getTaskStatus());
		preparedStatement.setString(3, task.getUserName());
		preparedStatement.executeUpdate();
	}
	
	
	private static String COMPLETE_TASK = "update tasklist set taskcompletionstatus = 'Y'"
			+ "where taskid = ?";
	public void markTaskComplete(Task task) throws Exception{
		Connection conn = dataSource.getConnection();
		PreparedStatement preparedStatement = conn.prepareStatement(COMPLETE_TASK);
		preparedStatement.setInt(1, task.getTaskId());
		preparedStatement.executeUpdate();
	}
	
	
	private static String DELETE_TASK = "delete tasklist where taskid = ?";
	public void deleteTask(Task task) throws Exception {
		Connection conn = dataSource.getConnection();
		PreparedStatement preparedStatement = conn.prepareStatement(DELETE_TASK);
		preparedStatement.setInt(1, task.getTaskId());
		preparedStatement.executeUpdate();
	}
	
	private static String GET_TASKS = "";
	public void getAllTask(Task task) throws Exception{
		Connection conn = dataSource.getConnection();
		Statement statement = conn.createStatement();
		
	}
	
	public void searchTask(String[] keyWords) throws Exception{
		
	}
			
 }
